<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Template-Selector</title>
<style>
.inputDiv {
	padding: 5px 5px;
	margin: 8px;
	display:table-row;
}

.myForm{
display:table;
padding: 5px 5px;
margin: 8px;
}
.inputDiv1 {
	padding: 5px 5px;
	margin: 8px;
	display:table-row;
}
label{
display:table-cell;
}
input{
display:table-cell;
}
.errorMsg {
	color: red;
	margin-top: 5px;
}
</style>
</head>
<body>
 <div class="inputDiv">
        <label for="templateselector">Choose a Template:</label>
        <select name="templateselection" id="templateselector" oninput="changeTemplate()">
        <option value="Select" id="templateselector">Select</option>
          <option value="Template1" id="templateselector">Lex-Template</option>
          <option value="Template2" id="templateselector">AnswerForce-Template</option>
        </select>
      </div>
      
    <br/>
    <br/>
    
    	<div id="myForm" class="myForm">
		<!-- <div class="inputDiv1">
			<label for="Name">Name:</label>
			<input id="username" type="text" name="username"
				onblur="validationform()" placeholder="Customer Name"class="inputdata" />
			<div id="usernamemsg" class="errorMsg"></div>
		</div>
		<div class="inputDiv1">
			<label for="Designation">Designation:</label>
			<input id="designation" type="text" name="designation"
				onblur="validationform()" placeholder="Designation" class="inputdata"/>
			<div id="designationmsg" class="errorMsg"></div>
		</div>

		<div class="inputDiv1">
			<label for="Email">Email:</label>
			<input id="email" type="text" name="email" onblur="validationform()"class="inputdata"
				placeholder="Email" />
			<div id="emailmsg" class="errorMsg"></div>
		</div>

		<div class="inputDiv1">
			<label for="Mobile">Mobile:</label>
			<input id="mobile" type="text" name="mobile"
				onblur="validationform()" class="inputdata"
				placeholder="Mobile Number" />
			<div id="mobilemsg" class="errorMsg"></div>
		</div>

		<div class="inputDiv1">
			<label for="AppointmentLink">AppointmentLink:</label>
			<input id="appointment" type="text" name="appointment" class="inputdata"
				onblur="validationform()" placeholder="AppointmentLink" />
			<div id="appointmentmsg" class="errorMsg"></div>
		</div>

		<div class="inputDiv1">
			<label for="ImageLink">ImageLink</label>
			<input type="text" id="image_input" accept="image/png, image/jpeg" class="inputdata"
				onblur="validationform()" placeholder="Write Your Image Link" />
			<div id="imagemsg" class="errorMsg"></div>
		</div>-->

	</div>
	
	<div class="inputDiv1">
			<button type="button" onclick="sendInput()" id="preview">Preview</button>
		</div> 
    
    <br/>
    <br/>
    
    <div id="display" style="position:relative; top:-90px"></div>
    
    <button id="download-btn" onclick="downloadTemplate()"
		style="position: relative; left: 350px; top: -240px">
		Download</button>
</body>
<script>

document.getElementById("myForm").style.display="none";
document.getElementById("preview").style.display = "block";

const dropdownMenu = document.getElementById('templateselector');
dropdownMenu.addEventListener('change', function() {
  const inputFields = document.querySelectorAll('.inputdata');
  inputFields.forEach(function(inputField) {
    inputField.value = '';
  });
});


//function createTemplate(Selector Name, List String body(creating elements,assigning names,setAttribute))

//This function is used to create inputFields dynamically
function inputSelector(selector){

   if(selector=="Template1"||selector=="Template2"){
	   console.log("Create 5 fields");
	   var Ninputs = 5;
	   for(var i = 0;i <= Ninputs;i++){
		   const inputDis = document.getElementById("myForm");
		   const inputDiv = document.createElement("div");
		   const errorMsg = document.createElement("div");
		   const labelName = document.createElement("label");
		   const createInput = document.createElement("input");
		   inputDiv.classList.add("inputDiv1");
		   errorMsg.classList.add("errorMsg");
		   createInput.type="text";
		   createInput.classList.add("inputdata");
		   fieldNames = ["name","designation","email","MobileNo","AppointmentLink","ImageLink"];
		   createInput.id=fieldNames[i];
		   errorMsg.id = fieldNames[i]+"msg";
		   createInput.setAttribute("onblur",(fieldNames[i]+"validation()"));
		   labelName.innerHTML=fieldNames[i]+":";
		   inputDis.appendChild(inputDiv);
		   createInput.placeholder = fieldNames[i];
		   inputDiv.append(labelName);
		   inputDiv.appendChild(createInput);
		   inputDiv.appendChild(errorMsg);
		   console.log(createInput.id);
	   }
   }else if(selector=="Template3"||selector=="Template4"){
	   console.log("Create 3 fields");
	   var Ninputs=3;
	   for(var i = 0;i < Ninputs;i++){
		   const inputDis = document.getElementById("myForm");
		   const inputDiv = document.createElement("div");
		   const errorMsg =  document.createElement("div");
		   const labelName = document.createElement("label");
		   const createInput = document.createElement("input");
		   inputDiv.classList.add("inputDiv1");
		   errorMsg.classList.add("errorMsg");
		   createInput.type="text";
		   createInput.classList.add("inputdata");
		   fieldNames = ["name","email","ImageLink"];
		   createInput.id=fieldNames[i];
		   errorMsg.id = fieldNames[i]+"msg";
		   createInput.setAttribute("onblur",(fieldNames[i]+"validation()"));
		   labelName.innerHTML=fieldNames[i]+":";
		   inputDis.appendChild(inputDiv);
		   inputDiv.appendChild(labelName);
		   createInput.placeholder = fieldNames[i];   
		   inputDiv.appendChild(createInput);
		   inputDiv.appendChild(errorMsg);
		   console.log(createInput.id);
	   }
   }else if(selector=="Select"){
	   console.log("Zero fields");
   }else{
	   console.log("");
   }
}



 function changeTemplate(){
    const dropdown = document.getElementById("templateselector");
    const selector = dropdown.options[dropdown.selectedIndex].value; 
  //  document.getElementById("download-btn").style.display = "none";
   // document.getElementById("preview").style.display="none";
   // console.log(selector);
   
    if(selector=="Select"){
    	document.getElementById("myForm").style.display="none";
    	//console.log("Inside If");
    	document.getElementById("display").innerHTML="";
    }else{
    	document.getElementById("myForm").innerHTML="";
    	inputSelector(selector);
    fetch('/templateselector',{
        method:'post',
        headers:{
            'Content-Type':'application/json; charset=UTF-8'
        },
        body:JSON.stringify({
           template:selector
        })
    }).then(response=>response.text())
      .then(html=>{
    	  const div = document.createElement('div');
    	  div.innerHTML = html;
    	   
    	 //   const div = document.createElement('iframe');
    	 //   div.srcdoc = html;   	    
    	 //   div.frameBorder = "0";
    	 //   div.style.width="100%";
    	 //   div.style.height="800px";
    	 
    	    const container = document.getElementById("display");
    	    container.innerHTML="";
    	    container.appendChild(div); 
    	    document.getElementById("myForm").style.display="block";
    	  //  document.getElementById("display").style.display="none";
    	  
      });
}
 }
 
 function resetForm(){
	 document.getElementsByTagName("input").value="";
	 console.log("hello");
 }
 
 //document.getElementById("display").style.display = "none";
// document.getElementById("download-btn").style.display = "none";
// document.getElementById("preview").style.display="none";

 
 
 function namevalidation(){
	 const name = document.getElementById("name").value;
	 const namemsg = document.getElementById("namemsg");
	 
	 var regName = /^[a-zA-Z- ]+$/;
	 
	  if (name == "" || name == null) {
	      namemsg.textContent = "Username is required";
	      return false;
	    } else if (!name.match(regName)) {
	      namemsg.textContent = "Name must be alphabets";
	      return false;
	    } else {
	        //count++;
	      namemsg.textContent = "";
	    }
	  Template.querySelector("#usernameResult").innerHTML = name;
 }
 
 function designationvalidation(){
	 const designation = document.getElementById("designation").value;
	 const designationmsg = document.getElementById("designationmsg");
	 var regName = /^[a-zA-Z- ]+$/;
	 
	 if (designation == "") {
	      designationmsg.textContent = "Designation is required";
	      return false;
	    } else if (!designation.match(regName)) {
	      designationmsg.textContent = "Designation must be alphabets";
	      return false;
	    } else {
	     //   count++;
	      designationmsg.textContent = "";
	    }
	 Template.querySelector("#designationResult").innerHTML = designation;
 }
 
 function emailvalidation(){
	 const email = document.getElementById("email").value;
	 const emailmsg = document.getElementById("emailmsg");
	 
	  if (email == "" || email == null) {
	      emailmsg.textContent = "Email is required";
	      return false;
	    } else if (
	      !email.match((/^([A-Za-z\-\.])+([A-Za-z0-9_]{0,4})+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/))
	    ) {
	      emailmsg.textContent = "Please provide a valid email";
	      return false;
	    } else {
	     // count++;
	      emailmsg.textContent = "";
	    }
	  Template.querySelector("#emailResult").innerHTML = email;
	  const emaillink = Template.querySelector("#emailLink");
	  emaillink.setAttribute("href", "mailto:" + email);
 }
 
 function MobileNovalidation(){
	 const mobile = document.getElementById("MobileNo").value;
	 const mobilemsg = document.getElementById("MobileNomsg");
	 
	    if (mobile == "") {
		      mobilemsg.textContent = "Mobile No is required";
		      return false;
		    } else if (mobile.length != 10) {
		      mobilemsg.textContent = "Your mobile number should be of 10 digits";
		      return false;
		    } else if (isNaN(mobile)) {
		      mobilemsg.textContent = "Mobile Number must be numeric";
		      return false;
		    } else if (
		      mobile.charAt(0) != 9 &&
		      mobile.charAt(0) != 8 &&
		      mobile.charAt(0) != 7 &&
		      mobile.charAt(0) != 6
		    ) {
		      mobilemsg.textContent = "Mobile Number should start from 9,8,7,6";
		      return false;
		    } else {
		    //   count++;
		      mobilemsg.textContent = "";

		    }
	    Template.querySelector("#mobileResult").innerHTML = mobile;
	    const mobilelink = Template.querySelector("#mobileLink");
	    mobilelink.setAttribute("href", "tel:" + mobile);
 }
 
 function AppointmentLinkvalidation(){
	 const appointmentvalidation = document.getElementById("AppointmentLink").value;
	 const appointmentmsg = document.getElementById("AppointmentLinkmsg");
	 
	  if (appointmentvalidation == "" || appointmentvalidation == null) {
	      appointmentmsg.textContent = "URL is required";
	      return false;
	    } else {
	        //count++;
	      appointmentmsg.textContent = "";
	    }
	  const bookappointmentlink = Template.querySelector("#bookappointmentlink");
	  bookappointmentlink.setAttribute("href", appointmentvalidation);
 }
 
 function ImageLinkvalidation(){
	 const imagevalidation = document.getElementById("ImageLink").value;
	 const imgurl = isImgUrl(imagevalidation);
	 const imagemsg = document.getElementById("ImageLinkmsg");
	 
	    if (imagevalidation == "" || imagevalidation == null) {
		      imagemsg.textContent = "Image URL is required";
		      return false;
		    } else {
		     //    count++;
		      imagemsg.textContent = "";
		    }

		    if(imgurl){
		    //	count++;
		      imagemsg.textContent = "";
		    }else{
		      imagemsg.textContent = "The URL provided isn't an Image";
		      return false;
		    }
		    Template.querySelector("#image").src = imagevalidation;
 }
 
 function isImgUrl(imagevalidation) {
	    const img = new Image();
	    img.src = imagevalidation;
	    return new Promise((resolve) => {
	        img.onerror = () => resolve(false);
	        img.onload = () => resolve(true);
	      })
	      .then(value => value)
	      .catch(value => value);    
	 }
 
/* 
 const name = document.getElementById("name").value;
 Template.querySelector("#usernameResult").innerHTML = name;
 
 const designation = document.getElementById("designation").value;
 Template.querySelector("#designationResult").innerHTML = designation;
 
 const email = document.getElementById("email").value;
 Template.querySelector("emailResult").innerHTML = email;
 const emaillink = Template.querySelector("#emailLink");
 emaillink.setAttribute("href", "mailto:" + email);
 
 const mobile = document.getElementById("MobileNo").value;
 Template.querySelector("mobileResult").innerHTML = mobile;
 const mobilelink = Template.querySelector("#mobileLink");
 mobilelink.setAttribute("href", "tel:" + mobile);
 
 const appointment = document.getElementById("AppointmentLink").value;
 const bookappointmentlink = Template.querySelector("#bookappointmentlink");
 bookappointmentlink.setAttribute("href", appointment);
 
 
 const image = document.getElementById("ImageLink").value;
 Template.querySelector("#image").src = image;
 
	document.getElementById("preview").style.display="block";*/
  /*async function validationform() {
	 
	    const name = document.getElementById("username").value;
	    const designation = document.getElementById("designation").value;
	    const email = document.getElementById("email").value;
	    const mobile = document.getElementById("mobile").value;
	    const appointmentvalidation = document.getElementById("appointment").value;
	    const imagevalidation = document.getElementById("image_input").value;
	    const imgurl = await isImgUrl(imagevalidation);
	    

	    const namemsg = document.getElementById("usernamemsg");
	    const designationmsg = document.getElementById("designationmsg");
	    const emailmsg = document.getElementById("emailmsg");
	    const mobilemsg = document.getElementById("mobilemsg");
	    const appointmentmsg = document.getElementById("appointmentmsg");
	    const imagemsg = document.getElementById("imagemsg");

	     let count = 0;
	    var regName = /^[a-zA-Z- ]+$/;

	    document.getElementById("preview").style.display="none";
	    document.getElementById("display").style.display="none";
	    document.getElementById("download-btn").style.display = "none";
	    
	    if (name == "" || name == null) {
	      namemsg.textContent = "Username is required";
	      return false;
	    } else if (!name.match(regName)) {
	      namemsg.textContent = "Name must be alphabets";
	      return false;
	    } else {
	        count++;
	      namemsg.textContent = "";
	    }

	    if (designation == "") {
	      designationmsg.textContent = "Designation is required";
	      return false;
	    } else if (!designation.match(regName)) {
	      designationmsg.textContent = "Designation must be alphabets";
	      return false;
	    } else {
	        count++;
	      designationmsg.textContent = "";

	    }

	    if (email == "" || email == null) {
	      emailmsg.textContent = "Email is required";
	      return false;
	    } else if (
	      !email.match((/^([A-Za-z\-\.])+([A-Za-z0-9_]{0,4})+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/))
	    ) {
	      emailmsg.textContent = "Please provide a valid email";
	      return false;
	    } else {
	      count++;
	      emailmsg.textContent = "";

	    }

	    if (mobile == "") {
	      mobilemsg.textContent = "Mobile No is required";
	      return false;
	    } else if (mobile.length != 10) {
	      mobilemsg.textContent = "Your mobile number should be of 10 digits";
	      return false;
	    } else if (isNaN(mobile)) {
	      mobilemsg.textContent = "Mobile Number must be numeric";
	      return false;
	    } else if (
	      mobile.charAt(0) != 9 &&
	      mobile.charAt(0) != 8 &&
	      mobile.charAt(0) != 7 &&
	      mobile.charAt(0) != 6
	    ) {
	      mobilemsg.textContent = "Mobile Number should start from 9,8,7,6";
	      return false;
	    } else {
	       count++;
	      mobilemsg.textContent = "";

	    }

	    if (appointmentvalidation == "" || appointmentvalidation == null) {
	      appointmentmsg.textContent = "URL is required";
	      return false;
	    } else {
	        count++;
	      appointmentmsg.textContent = "";

	    }

	    if (imagevalidation == "" || imagevalidation == null) {
	      imagemsg.textContent = "Image URL is required";
	      return false;
	    } else {
	         count++;
	      imagemsg.textContent = "";
	    }

	    if(imgurl){
	    	count++;
	      imagemsg.textContent = "";
	    }else{
	      imagemsg.textContent = "The URL provided isn't an Image";
	      return false;
	    }

	        if (count == 7) {
	          	console.log("Inside if:",count);
	       	document.getElementById("preview").style.display="block";
	          return true;
	           }
	  }

		  function sendInput(){
		  const name = document.getElementById("username").value;
		    const designation = document.getElementById("designation").value;
		    const email = document.getElementById("email").value;
		    const mobile = document.getElementById("mobile").value;
		    const image = document.getElementById("image_input").value;
		    const appointment = document.getElementById("appointment").value;
	        
		    Template.querySelector("#usernameResult").innerHTML = name;
		    Template.querySelector("#designationResult").innerHTML = designation;
		    Template.querySelector("#emailResult").innerHTML = email;
		    Template.querySelector("#mobileResult").innerHTML = mobile;

		    const mobilelink = Template.querySelector("#mobileLink");
		    const emaillink = Template.querySelector("#emailLink");
		    Template.querySelector("#image").src = image;
		    const bookappointmentlink = Template.querySelector(
		      "#bookappointmentlink"
		    );
		    mobilelink.setAttribute("href", "tel:" + mobile);
		    emaillink.setAttribute("href", "mailto:" + email);
		    bookappointmentlink.setAttribute("href", appointment);
	  
		  document.getElementById("display").style.display = "block";
		  document.getElementById("download-btn").style.display = "block";
	  }*/
	  
 function downloadTemplate() {
	    const name = document.getElementById("name").value;
	    const template = document.getElementById("Template");
	    const downloadBtn = document.getElementById("download-btn");
	    const downloadContent = template.innerHTML;
	    const fileName = `${name}.html`;
	    const file = new Blob([downloadContent], {
	      type: "text/html"
	    });
	    const url = URL.createObjectURL(file);
	    const a = document.createElement("a");
	    a.href = url;
	    a.download = fileName;
	    document.body.appendChild(a);
	    a.click();
	    a.remove();
	    URL.revokeObjectURL(url);
	  }
</script>
</html>